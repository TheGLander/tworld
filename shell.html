<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Emscripten-Generated Code</title>
		<style>
			.center-text {
				text-align: center;
			}

			#canvas {
				border: 0px none;
				background-color: black;
				padding-right: 0;
				margin-left: auto;
				margin-right: auto;
			}
		</style>
	</head>
	<body>
		<div class="center-text" id="status">Downloading...</div>
		<div class="center-text">
			<a href="https://github.com/TheGLander/tworld-wii/tree/emscripten"
				>Check out the source code!</a
			>
		</div>
		<canvas id="canvas" tabindex="-1"></canvas>

		<script type="text/javascript">
			const statusElement = document.getElementById("status")
			const canvasElement = document.getElementById("canvas")
			canvasElement.style.display = "none"

			canvasElement.addEventListener("contextmenu", () =>
				event.preventDefault()
			)

			const params = new URLSearchParams(location.search)
			const mapPath = params.get("map")
			const levelId = params.get("levelId")
			const solution = params.get("solution")
			const lynx = params.get("lynx")

			globalThis.Module = {
				arguments: ["-p"],
				preRun: [
					() => {
						if (lynx !== null) Module.arguments.push("-x")
						if (!mapPath) return
						FS.createPreloadedFile("/", "custom.dat", mapPath, true, true)
						Module.arguments.push("/custom.dat")
						if (solution || levelId) Module.arguments.push(levelId || "1")
						if (solution) {
							FS.createPreloadedFile(
								"/",
								"/customSol.tws",
								solution,
								true,
								true
							)
							Module.arguments.push("/customSol.tws")
						}
					},
					() => (canvasElement.style.display = "block"),
				],
				postRun: [],
				print: console.log,
				printErr: console.error,
				canvas: canvasElement,
				setStatus: text => (statusElement.innerText = text),
				totalDependencies: 0,
				monitorRunDependencies: function (left) {
					this.totalDependencies = Math.max(this.totalDependencies, left)
					Module.setStatus(
						left
							? "Preparing... (" +
									(this.totalDependencies - left) +
									"/" +
									this.totalDependencies +
									")"
							: "All downloads complete."
					)
				},
			}
			Module.setStatus("Downloading...")
		</script>
		{{{ SCRIPT }}}
	</body>
</html>
